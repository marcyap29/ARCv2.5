# iOS Build: rivet_models.g.dart — keywords List vs Set<String> Type Error

Date: 2026-02-13  
Status: Resolved  
Area: Build, iOS, RIVET, Hive  
Severity: Critical (build-blocking)

## Summary
`flutter build ios --release` failed with a Dart type error in generated code: `lib/prism/atlas/rivet/rivet_models.g.dart`. The `RivetEventAdapter.read()` method assigned `List<String>` to `keywords` while `RivetEvent` expects `Set<String>`.

## Error (from build log)
```
lib/prism/atlas/rivet/rivet_models.g.dart:23:37: Error: The argument type 'List<String>' can't be assigned to the parameter type 'Set<String>'.
 - 'List' is from 'dart:core'.
 - 'Set' is from 'dart:core'.
      keywords: (fields[3] as List).cast<String>(),
                                    ^
Target kernel_snapshot_program failed: Exception
Failed to package EPI.
```

## Root cause
- `rivet_models.g.dart` is generated by `hive_generator` / `build_runner` from `rivet_models.dart`.
- `RivetEvent.keywords` is declared as `Set<String>` in `rivet_models.dart`.
- The generated TypeAdapter read path deserializes a list from Hive and used `(fields[3] as List).cast<String>()`, which yields `List<String>`, not `Set<String>`.

## How to fix

1. **Edit the generated file** (if the error reappears after codegen):  
   Open `EPI/lib/prism/atlas/rivet/rivet_models.g.dart` and locate the `RivetEventAdapter.read()` method (around line 19–26).

2. **Change the `keywords` line** so it produces a `Set<String>`:
   - **Wrong:** `keywords: (fields[3] as List).cast<String>(),`
   - **Correct:** `keywords: (fields[3] as List).cast<String>().toSet(),`  
   Add `.toSet()` so the argument type is `Set<String>`.

3. **If you prefer not to edit generated code:** After running `dart run build_runner build` (or `build_runner build --delete-conflicting-outputs`), check whether the generator wrote the wrong line and re-apply the `.toSet()` change. Optionally add a custom generator or patch the hive_generator template if this regresses often.

4. **Verify:** Run `flutter build ios --release` (or `flutter build ios`) and confirm the type error is gone.

## Resolution
Current codebase already has the fix at line 22 of `rivet_models.g.dart`: `keywords: (fields[3] as List).cast<String>().toSet(),`. Build should succeed after a clean build. If the file is ever overwritten by codegen, re-add `.toSet()` as above.

## Related
- [ios-release-build-third-party-warnings.md](ios-release-build-third-party-warnings.md) — other warnings from the same iOS release build
- [ios-build-local-embedding-service-errors.md](ios-build-local-embedding-service-errors.md) — other iOS build failures

## References
- Terminal build log: 2026-02-13, `flutter build ios --release && flutter install -d <device>`
- Source: `EPI/lib/prism/atlas/rivet/rivet_models.dart` (keywords as `Set<String>`), `rivet_models.g.dart` (TypeAdapter)
